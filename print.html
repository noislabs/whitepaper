<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Nois Network</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="title.html">Nois Network</a></li><li class="chapter-item expanded "><a href="abstract.html"><strong aria-hidden="true">1.</strong> Abstract</a></li><li class="chapter-item expanded "><a href="the_naive_approach.html"><strong aria-hidden="true">2.</strong> The Naive Approach</a></li><li class="chapter-item expanded "><a href="our_approach.html"><strong aria-hidden="true">3.</strong> Our Approach</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="security.html"><strong aria-hidden="true">3.1.</strong> Security</a></li><li class="chapter-item expanded "><a href="performance.html"><strong aria-hidden="true">3.2.</strong> Performance</a></li><li class="chapter-item expanded "><a href="cost_efficiency.html"><strong aria-hidden="true">3.3.</strong> Cost Efficiency</a></li><li class="chapter-item expanded "><a href="developer_focussed.html"><strong aria-hidden="true">3.4.</strong> Developer Focussed</a></li></ol></li><li class="chapter-item expanded "><a href="further_work.html"><strong aria-hidden="true">4.</strong> Further Work</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Nois Network</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/noislabs/whitepaper" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="nois-network"><a class="header" href="#nois-network">Nois Network</a></h1>
<p>Nois Network aims to bring randomness (or noise) to the Cosmos ecosystem by providing a safe and secure entropy source and distributing randomness in the form of <a href="http://www.copenhagen-interpretation.com/home/cryptography/cryptographic-beacons">random beacons</a> to other Cosmos blockchains via <a href="https://ibc.cosmos.network/">IBC</a>.</p>
<h2 id="definitions"><a class="header" href="#definitions">Definitions</a></h2>
<p>In this context we talk about public randomness, i.e. values that are unpredictable for all participants but once they are revealed, they are free to share. Private randomness that needs to be kept secret by one or some participants is out of scope for this document.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="abstract"><a class="header" href="#abstract">Abstract</a></h1>
<p>Randomness is a basic building block for all sorts of applications. The use case range from lotteries that fully rely on randomness over games that may have some random elements to probabilistic modeling, simulations and governance applications.</p>
<p>Blockchains are systems in which every node in a decentralized network can validate the state of a replicated database by independently executing transactions and comparing the results. In order to do that, all computations need to be determinstic. When the node's specific context is accessed, such as the system's clock or a local random number generator, nodes may come to different results and fall out of consensus.</p>
<p>The operations performed on blockchains get more sophisticated every year. While Bitcoin only allows token sends, the next geneartion brought turing complete computations on chain (Ethereum), creating complex financial products and the first governance applications. Today we are seeing this idea laveraged more and more as the price for execution drops significantly on Layer 2 solutions and independent blockchains in Cosmos<sup>1</sup>. The usage of WebAssembly brings a sandboxing technology to blockchains that was designed to run at near native speed on today's CPUs (CosmWasm, NEAR). Multiple projects are working on rich governance applications and games<sup>2</sup>.</p>
<p>In this document, we describe how Nois brings decentralised randomness on chain and distributes it to a multitude of other IBC enabled chains in a very secure, fast, decentralised, cost efficient, and developer-focused manner.</p>
<h2 id="footnotes"><a class="header" href="#footnotes">Footnotes</a></h2>
<p><sup>1</sup> Cosmos referes to the ecosystem of independent blockchains that communicate via IBC, not the Cosmos Hub.</p>
<p><sup>2</sup> TODO: provide examples</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-naive-approach"><a class="header" href="#the-naive-approach">The Naive Approach</a></h1>
<p>Blockchain applications can access certain information from the environment, that are deterministic and appear to be random at first glance. But usually those values are predictable or can be manipulated. E.g.</p>
<ol>
<li>Solidity's <code>block.timestamp</code> can be set by the miner.</li>
<li>Solidity's <code>blockhash</code> is a value the miner can influence.</li>
<li>The block time of Tendermint (<a href="https://docs.tendermint.com/master/spec/consensus/bft-time.html">BFT Time</a>) is of low entropy and can be influenced.</li>
<li>CosmWasm team decided to <a href="https://github.com/CosmWasm/wasmvm/issues/133">not expose block hash</a> as this may falsely be assumed to be unpredictable but can be influenced by the block proposer.</li>
<li>Block height has very low entropy as the height in which a transaction is included can be guessed.</li>
<li>Another thing that was spotted in the wild is using signatures as randomness. A pre-defined signer is asked to sign a given challenge. However, <a href="https://medium.com/@simonwarta/signature-determinism-for-blockchain-developers-dbd84865a93e">it turns out</a> that common signing algorithms produce a deterministic but not unique signature, such that the signer can choose whatever value suits them.</li>
</ol>
<p>To get relyable randomness, we need to do better.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="our-approach"><a class="header" href="#our-approach">Our Approach</a></h1>
<p>Nois Network aims to provide a safe and secure solution to the problem that is native to the IBC world and provides the best possible user experience for a wide range of applications.</p>
<p>In contrast to other consensus algorithms, Tendermint-based blockchains do not need randomness at block production layer. As a consequence no random value can trivially be passed to applications from consensus. So our randomness solition will live entirely on the app level, allowing us to keep block production going even when there is a hickup in the the randomness part.</p>
<p>In the first iteration, Nois will use random beacons produced by the <a href="https://drand.love">drand</a> network, which is powered by a consortium of participants that generate randomness using multi-party computation. This is implemented using BLS threshold signatures, which produces unpredictable values that cannot be manipulated by any of the drand participants. The drand mainnet is instantiated by the <a href="https://en.wikipedia.org/wiki/League_of_entropy">Legue of Entropy</a>, which has been operating it in production for more than two years. For example, Filecoin relies on drand for block production.</p>
<p>Drand random beacons can be submitted to blockchains that perform BLS signature verification. This way we can build a random oracle that securely brings randomness on chain. This method was <a href="https://medium.com/@simonwarta/when-your-blockchain-needs-to-roll-the-dice-ed9da121f590">described and proven in 2020 for CosmWasm</a>. A few months later, this proof of concept was turned into production by <a href="https://docs.terrand.dev/">Terrand</a>. BLS verification is a computationally heavy operation, but leveraging the strength of the Rust optimizer and Wasm's near native execution speed, Drand beacons could be verified for less than 3$ in gas fees on Terra.</p>
<p>The next step in the evolution is to make drand beacons easily accessible by as many dapps as possible in a way that is easy to use and affordable. In an ideal world a dapp developer would just do something like this:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// pseudo-code
let beacon: [u8; 32] = await getRandom();
<span class="boring">}
</span></code></pre></pre>
<p>We believe the burden of implementing drand verification once per contract or even once per blockchain is too much in an ecosystem that is preparing for thousands of independent and inter-connected blockchains. So instead of executing the drand verification on the chain of the dapp, IBC is used to request the beacon from the Nois Network.</p>
<h3 id="how-it-works"><a class="header" href="#how-it-works">How it works</a></h3>
<p>The following steps are taken to get the randomness:</p>
<ol>
<li>Contract on a CosmWasm-enabled chain (such as Juno or Tgrade) sends a message to a Nois proxy contract on the same chain. A reply with further information regarding the job is sent to the original contract.</li>
<li>The proxy contract sends an IBC message to its couter-part on the Nois Network where the job is put in the queue.</li>
<li>Once the drand beacon of the correct round is released, a network of bots sends it to the Nois Network for verification.</li>
<li>After successful verfication, the pending jobs for the round are processed. For every matching job, an IBC response with the beacon is sent.</li>
<li>The proxy contract receives the beacon and sends a callback to the original contract.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="security"><a class="header" href="#security">Security</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="performance"><a class="header" href="#performance">Performance</a></h1>
<h2 id="commit-to-callback-time-c2c-time"><a class="header" href="#commit-to-callback-time-c2c-time">Commit to Callback Time (C2C Time)</a></h2>
<p>Each Drand round is published at fixed points in time calculated as follows:</p>
<pre><code>publish_time := genesis + (round - 1) * 30
</code></pre>
<p>where <code>genesis</code> is the drand network's start time (UNIX timestamp), <code>round</code> is an incremening integer starting at 1 and <code>30</code> is the 30 seconds round time.</p>
<p>Once this <code>publish_time</code> is reached, the randomness needs to be considered public. No matter if the chain or the contract knows the value already, any user can know the random value by observing the off-chain drand network. So it is important that after <code>publish_time</code> no actions for that round are allowed anymore. Think of it as closing submission of lottery tickets. Now the round should be processed as fast as possible in order to reveal the results and allow to continue the operation in case the next steps depend on it.</p>
<p>The time between beacon publishing an the callback consists of the following components:</p>
<ul>
<li><strong>Bot submission:</strong> Multiple bots should observe the drand gossip network through varius communication protocols. Once a new round is found, they should craft a transaction, sign it and sent it to the Nois mempool. The fastest submission of one of the bots matters. When well connected, this should be doable in 1 second.</li>
<li><strong>Block inclusion time:</strong> When the beacon is in the mempool, the chain should ensure it is included in a block as fast as possible. With 5 second block times and an inclusion in the first or second block, this should be up to 10 seconds. The same transaction processes pending jobs and sends IBC messages. The block is executed in well under 1 second.</li>
<li><strong>IBC relaying:</strong> An IBC relayer picks up the message from the Nois chain and relays it to the destination chain. This depends on well configured and well connected relayers as well as availability of block space on the destination chain. In order to be included as fast as possible, the relayer should pay a transaction fee that is accepted by all validators. But in a high trafic sitiation, we don't get guearantees to be included quickly. So 5-20 seconds is a reasonable estimate.</li>
<li><strong>Acknowledgement:</strong> An IBC acknowledgement is sent to Nois but this is nothing the contract needs to wait for.</li>
</ul>
<p>Once those steps are done, the callback is executed within 30 seconds of publishing. On a well configured network, average timings can be much faster though.</p>
<h2 id="choice-of-round"><a class="header" href="#choice-of-round">Choice of round</a></h2>
<p>The application needs to commit to a round number before the beacon is revealed.
Fortunately we have a relyable <a href="https://docs.tendermint.com/master/spec/consensus/bft-time.html">BFT Time</a> but this is not perfectly accurate and can be behind. In case the contract thinks <code>publish_time</code> is not yet reached while the beacon is already published, an attacker can abuse the knowledge of the randomness. So we intoduce a duration <code>safety_margin</code> and require <code>publish_time</code> to be at least <code>safety_margin</code> after the current BFT time (<code>block_time</code>).</p>
<p>Using the formular from above, we want</p>
<pre><code>(1) publish_time := genesis + (round - 1) * 30
(2) publish_time &gt;= block_time + safety_margin

genesis + (round - 1) * 30 &gt;= block_time + safety_margin
(round - 1) * 30 &gt;= block_time + safety_margin - genesis
round - 1 &gt;= (block_time + safety_margin - genesis) / 30
round &gt;= ((block_time + safety_margin - genesis) / 30) + 1
</code></pre>
<p>This inequality is satisfied when doing</p>
<pre><code>round := ceil((block_time + safety_margin - genesis) / 30) + 1
</code></pre>
<p>Assuming <code>safety_margin</code> is set generously to 2 seconds, the <code>round</code> calculated that way is 2-32 seconds in the future.</p>
<p>This calculation can be generalized if an end time should be set in advance instead of closing right away. With flexible end times, the publish times of beacons can be matched and only the safety margin need to be considered.</p>
<h2 id="short-block-times"><a class="header" href="#short-block-times">Short Block Times</a></h2>
<p>The Nois network can consider to reduce block times from the typical 5-7 seconds in Cosmos to something shorter. Doing so has to be carefully tested in environments with many globally distributed validators. But seeing teams successfully testing 1s block times is promising.</p>
<h2 id="high-frequency-beacons"><a class="header" href="#high-frequency-beacons">High Frequency Beacons</a></h2>
<p>Right now drand emits a new beacon every 30 seconds. But there are plans to reduce that round time to something like 3 or 5 seconds. This will allow Nois to operate on higher frequency.</p>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>When comitting to a round in 2-32 seconds that needs roughly 10-30 seconds to be processed, you get a delay between commitment to callback of 12-62 seconds. Various usecase specific optimization techniques are to be explored.</p>
<p>This end-to-end randomness distribution speed can improve significantly with the upcoming drand frequency change.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cost-efficiency"><a class="header" href="#cost-efficiency">Cost Efficiency</a></h1>
<p>Nois uses highly efficient Tendermint, IBC and CosmWasm technology to provide a cost efficient solution to users.</p>
<h2 id="verify-on-each-app-chain"><a class="header" href="#verify-on-each-app-chain">Verify on each app chain</a></h2>
<p>An alternative approach to verifying the beacon on one chain and then distributing it accross chains would be to verify the beacon once per app chain, i.e. have a Terrand-like instance on Terra, Juno, Tgrade, …. The bot network would then need to submit the beacon to each chain. This would remove the need for a Nois chain and IBC relayers. It could also remove the time between publication and callback.</p>
<p>However, drand verification comsumes a lot of gas and doing that once per chain is potentially inefficient. When blockspace is limited, the beacon submission transaction might not get committed for a long time.</p>
<p>There are pros and cons on both sides. But when thinking about hundreds of connected app chains the deduplication of the verification feels right. Also with IBC queries upcoming, <a href="https://twitter.com/hdevalence/status/1555256686641786882">our state becomes your state</a>.</p>
<h2 id="the-app-chain-model"><a class="header" href="#the-app-chain-model">The app chain model</a></h2>
<p>A drand verifier that is accessible via IBC can be implemented on an existing chain with CosmWasm. This would be easier to start with and would not require a new token. However, going for a custom app chain has the following motivation:</p>
<ul>
<li>Cosmos is an ecosystem of app specific chains where creating one chain is relatively easy.
The mentality in the ecosystem is to have many chains that are independent and interconnected.
The tooling and people are ready for many chains.</li>
<li>In a world with competing app chains that host our users, running on one of those chains makes us biased towards this chain.
Being neutral regarding chains is very helpful in politics.</li>
<li>The randomness chain would not halt if the smart contract chains halts.</li>
<li>The ability to create overlapping validator and drand MPC sets is a way to incentivise drand node operators and get new players into Cosmos.</li>
<li>The following optimizations are possible:
<ol>
<li>The drand verification contract is 550 KB large. Terrand had to split the code in two contracts to deploy it to Terra.
A custom chain can allow lager contract sizes.</li>
<li>The verification consumes significant block space and may get expensive on other general purpose chains.</li>
<li>CosmWasm allows pinning contracts. Those contracts are kept in memory and are loaded and executed faster.
We can utilize this feature on a custom chain.</li>
<li>CosmWasm has a somewhat unknown cronjob feature that allows governance to run contract execution in every block.
That’s useful to e.g. process queues.</li>
<li>We can use chain governance to upgrade the contract which is more transparent and safer than multisig upgradability.</li>
<li>Due to permissioned contract uploads the use of a Wasm compiler with unbound compile time becomes possible,
which can lead to faster verification.</li>
</ol>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="developer-focussed"><a class="header" href="#developer-focussed">Developer Focussed</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="further-work"><a class="header" href="#further-work">Further Work</a></h1>
<p>The solution above explains what we can do with technology available today. But we'll not stop there. The next steps might be the following (unsorted).</p>
<h2 id="ibc-queries"><a class="header" href="#ibc-queries">IBC Queries</a></h2>
<p>We'll closely follow the development of IBC queries, which is a technology we assume to allow for faster round trips and lower fees.</p>
<h2 id="alternative-entropy-sources"><a class="header" href="#alternative-entropy-sources">Alternative Entropy Sources</a></h2>
<p>We love what drand and the League of Entropy brought to the internet, which is nothing less than the first decentralized entropy source. But choice is important. Some applications may wish to sacrifice some of the security properties in order to get faster and cheaper randomness. Some users might demand governance voting for drand <a href="https://en.wikipedia.org/wiki/Secure_multi-party_computation">MPC</a> participants. The options are to be explored but the network will be designed for multiple sources.</p>
<h2 id="internalizing-randomness-generation"><a class="header" href="#internalizing-randomness-generation">Internalizing randomness generation</a></h2>
<p>The node operators of the Nois Network could integrate randomness generation into their own operations. There has been work to <a href="https://medium.com/@dgaminghub/arcade-tendermint-hack-with-built-in-threshold-bls-random-beacon-for-applications-a51eafb77f53">integrate random beacons into Tendermint</a> that could be explored. But also a second process that runs along with the validator node would be an option.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
